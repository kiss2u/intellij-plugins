package com.intellij.javascript.flex.maven;

import com.intellij.lang.javascript.flex.build.FlexCompilerProjectConfiguration;
import com.intellij.openapi.options.ConfigurationException;
import com.intellij.openapi.options.UnnamedConfigurable;
import com.intellij.openapi.project.Project;
import com.intellij.ui.IdeBorderFactory;
import com.intellij.uiDesigner.core.GridConstraints;
import com.intellij.uiDesigner.core.GridLayoutManager;
import org.jetbrains.idea.maven.project.AdditionalMavenImportingSettings;

import javax.swing.BorderFactory;
import javax.swing.JCheckBox;
import javax.swing.JComponent;
import javax.swing.JPanel;
import javax.swing.border.TitledBorder;
import java.awt.Insets;

public final class FlexmojosImportingSettings implements AdditionalMavenImportingSettings {

  @Override
  public UnnamedConfigurable createConfigurable(final Project project) {
    return new FlexmojosImportingConfigurable(project);
  }

  private static class FlexmojosImportingConfigurable implements UnnamedConfigurable {

    private final FlexCompilerProjectConfiguration myConfig;

    private final JPanel myMainPanel;
    private final JCheckBox myGenerateFlexCompilerConfigurationCheckBox;

    FlexmojosImportingConfigurable(final Project project) {
      {
        // GUI initializer generated by IntelliJ IDEA GUI Designer
        // >>> IMPORTANT!! <<<
        // DO NOT EDIT OR ADD ANY CODE HERE!
        myMainPanel = new JPanel();
        myMainPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
        myMainPanel.putClientProperty("BorderFactoryClass", "com.intellij.ui.IdeBorderFactory$PlainSmallWithIndent");
        myMainPanel.setBorder(IdeBorderFactory.PlainSmallWithIndent.createTitledBorder(BorderFactory.createEtchedBorder(), "Flexmojos",
                                                                                       TitledBorder.DEFAULT_JUSTIFICATION,
                                                                                       TitledBorder.DEFAULT_POSITION, null, null));
        myGenerateFlexCompilerConfigurationCheckBox = new JCheckBox();
        myGenerateFlexCompilerConfigurationCheckBox.setText("Generate Flex compiler configuration files when importing Flexmojos projects");
        myGenerateFlexCompilerConfigurationCheckBox.setMnemonic('X');
        myGenerateFlexCompilerConfigurationCheckBox.setDisplayedMnemonicIndex(12);
        myMainPanel.add(myGenerateFlexCompilerConfigurationCheckBox,
                        new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE,
                                            GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW,
                                            GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
      }
      myConfig = FlexCompilerProjectConfiguration.getInstance(project);
    }

    /** @noinspection ALL */
    public JComponent $$$getRootComponent$$$() { return myMainPanel; }

    @Override
    public JComponent createComponent() {
      return myMainPanel;
    }

    @Override
    public boolean isModified() {
      return myGenerateFlexCompilerConfigurationCheckBox.isSelected() != myConfig.GENERATE_FLEXMOJOS_CONFIGS;
    }

    @Override
    public void apply() throws ConfigurationException {
      myConfig.GENERATE_FLEXMOJOS_CONFIGS = myGenerateFlexCompilerConfigurationCheckBox.isSelected();
    }

    @Override
    public void reset() {
      myGenerateFlexCompilerConfigurationCheckBox.setSelected(myConfig.GENERATE_FLEXMOJOS_CONFIGS);
    }
  }
}
